<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug Print Mode</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .container { max-width: 600px; margin: 0 auto; }
        .listbox { height: 300px; border: 1px solid #ccc; position: relative; }
        .debug { background: #f0f0f0; padding: 10px; margin: 10px 0; font-family: monospace; }
        button { padding: 10px 20px; margin: 5px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>Debug Print Mode Issue</h1>
        
        <button onclick="togglePrintMode()">Toggle Print Mode</button>
        <button onclick="checkTemplates()">Check Templates</button>
        
        <div class="debug" id="debug-output">Debug output will appear here...</div>
        
        <div class="listbox" id="listbox"></div>
    </div>

    <template id="normal-template">
        <div style="padding: 10px; border: 1px solid blue; margin: 2px;">
            <strong>{{name}}</strong> - {{department}}
        </div>
    </template>

    <template id="print-template">
        <div style="padding: 2px; margin: 1px;">
            {{name}} | {{department}}
        </div>
    </template>

    <script src="datamaster.js"></script>
    <script src="jw-listbox.js"></script>
    <script>
        const testData = [
            { id: 1, name: 'Alice', department: 'Engineering' },
            { id: 2, name: 'Bob', department: 'Sales' }
        ];

        let listbox;
        let printMode = false;

        function log(message) {
            const output = document.getElementById('debug-output');
            output.innerHTML += new Date().toLocaleTimeString() + ': ' + message + '<br>';
        }

        function initializeDemo() {
            try {
                log('Initializing listbox...');
                listbox = new JwListBox('#listbox');
                
                log('Setting source data...');
                listbox.setSource(testData);
                
                log('Setting normal template...');
                listbox.setTemplate('#normal-template');
                
                log('Setting print template...');
                listbox.setPrintTemplate('#print-template');
                
                log('Setting display mode to list...');
                listbox.setDisplayMode('list');
                
                log('Initialization complete!');
                
                // Debug template retrieval
                checkTemplates();
                
            } catch (error) {
                log('ERROR: ' + error.message);
                console.error(error);
            }
        }

        function togglePrintMode() {
            try {
                printMode = !printMode;
                log('Toggling print mode to: ' + printMode);
                
                // Check current templates before toggle
                log('Before toggle - Normal template: ' + (listbox._options.template || 'not set'));
                log('Before toggle - Print template: ' + (listbox._options.printTemplate || 'not set'));
                
                listbox.printMode(printMode);
                
                log('Print mode toggled successfully!');
                
            } catch (error) {
                log('ERROR in togglePrintMode: ' + error.message);
                console.error(error);
            }
        }

        function checkTemplates() {
            try {
                log('=== Template Check ===');
                log('Normal template option: ' + (listbox._options.template || 'not set'));
                log('Print template option: ' + (listbox._options.printTemplate || 'not set'));
                log('Print mode enabled: ' + (listbox._options.printMode || false));
                
                // Test template retrieval
                const currentTemplate = listbox._getTemplate();
                log('Current template content length: ' + (currentTemplate ? currentTemplate.length : 'null'));
                log('Current template preview: ' + (currentTemplate ? currentTemplate.substring(0, 100) + '...' : 'null'));
                
            } catch (error) {
                log('ERROR in checkTemplates: ' + error.message);
                console.error(error);
            }
        }

        document.addEventListener('DOMContentLoaded', initializeDemo);
    </script>
</body>
</html>
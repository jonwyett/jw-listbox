<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JwListBox Sprint 10 Demo - Print Mode & Loading Indicators</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f5f5f5;
        }
        .demo-container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .demo-section {
            margin-bottom: 40px;
            padding: 20px;
            border: 1px solid #e0e0e0;
            border-radius: 5px;
        }
        .demo-section h3 {
            margin-top: 0;
            color: #333;
        }
        .controls {
            margin-bottom: 20px;
            padding: 15px;
            background-color: #f8f9fa;
            border-radius: 5px;
        }
        .controls button {
            margin: 5px;
            padding: 8px 15px;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        .controls button:hover {
            background-color: #0056b3;
        }
        .listbox-container {
            height: 300px;
            border: 1px solid #ccc;
            position: relative;
        }
        .output {
            margin-top: 15px;
            padding: 10px;
            background-color: #f8f9fa;
            border-radius: 4px;
            font-family: monospace;
            font-size: 12px;
            white-space: pre-wrap;
            max-height: 200px;
            overflow-y: auto;
        }
        .template-examples {
            margin-top: 15px;
        }
        .template-examples textarea {
            width: 100%;
            height: 100px;
            margin: 5px 0;
            font-family: monospace;
        }
        @media print {
            .controls, .demo-section h3, .output {
                display: none !important;
            }
            .listbox-container {
                border: none !important;
                height: auto !important;
            }
        }
        .info-panel {
            background-color: #e9ecef;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
        }
        .info-panel h4 {
            margin-top: 0;
            color: #495057;
        }
    </style>
</head>
<body>
    <div class="demo-container">
        <h1>JwListBox Sprint 10 Demo</h1>
        <p>This demo validates all Sprint 10 features: Print Mode, Loading Indicators, Data Export, and Metadata methods.</p>

        <!-- Print Mode Demo -->
        <div class="demo-section">
            <h3>1. Print Mode Functionality</h3>
            <div class="info-panel">
                <h4>Feature Description:</h4>
                <p>Print mode switches the component to use a print-friendly template, removing table structures and focusing on readable content for printing.</p>
            </div>
            
            <div class="controls">
                <button onclick="togglePrintMode()">Toggle Print Mode</button>
                <button onclick="window.print()">Print Preview</button>
                <button onclick="setPrintTemplate()">Set Custom Print Template</button>
                <span id="print-status">Print Mode: OFF</span>
            </div>

            <div class="template-examples">
                <label>Regular Template:</label>
                <textarea id="regular-template" readonly><div class="person-card">
    <h4>{{name}}</h4>
    <p>Department: {{department}}</p>
    <p>Salary: ${{salary}}</p>
    <p>Status: {{status}}</p>
</div></textarea>

                <label>Print Template:</label>
                <textarea id="print-template" readonly><div class="print-person">
    {{name}} - {{department}} - ${{salary}} ({{status}})
</div></textarea>
            </div>

            <div class="listbox-container" id="print-listbox"></div>
            <div class="output" id="print-output"></div>
        </div>

        <!-- Loading Indicators Demo -->
        <div class="demo-section">
            <h3>2. Loading Indicators</h3>
            <div class="info-panel">
                <h4>Feature Description:</h4>
                <p>Loading indicators provide visual feedback during data operations. Includes both overlay loading messages and "load more" buttons.</p>
            </div>
            
            <div class="controls">
                <button onclick="showLoadingIndicator()">Show Loading</button>
                <button onclick="hideLoadingIndicator()">Hide Loading</button>
                <button onclick="showLoadMoreButton()">Show Load More</button>
                <button onclick="hideLoadMoreButton()">Hide Load More</button>
                <button onclick="simulateDataLoading()">Simulate Data Loading</button>
            </div>

            <div class="listbox-container" id="loading-listbox"></div>
            <div class="output" id="loading-output"></div>
        </div>

        <!-- Data Export Demo -->
        <div class="demo-section">
            <h3>3. Data Export Utilities</h3>
            <div class="info-panel">
                <h4>Feature Description:</h4>
                <p>Export data in multiple formats (recordset, table, CSV) from either the master dataset or the currently filtered view.</p>
            </div>
            
            <div class="controls">
                <button onclick="exportAsRecordset()">Export as Recordset</button>
                <button onclick="exportAsTable()">Export as Table</button>
                <button onclick="exportAsCSV()">Export as CSV</button>
                <button onclick="exportAllData()">Export All Data (Master)</button>
                <button onclick="filterAndExport()">Filter Data & Export View</button>
            </div>

            <div class="listbox-container" id="export-listbox"></div>
            <div class="output" id="export-output"></div>
        </div>

        <!-- Metadata Methods Demo -->
        <div class="demo-section">
            <h3>4. Metadata Methods</h3>
            <div class="info-panel">
                <h4>Feature Description:</h4>
                <p>Access component metadata like row count and field names for programmatic integration.</p>
            </div>
            
            <div class="controls">
                <button onclick="getRowCount()">Get Row Count</button>
                <button onclick="getFieldNames()">Get Field Names</button>
                <button onclick="getFieldsFromMaster()">Get Fields from Master</button>
                <button onclick="addDataAndUpdateMetadata()">Add Data & Update Metadata</button>
                <button onclick="searchAndUpdateMetadata()">Search & Update Metadata</button>
            </div>

            <div class="listbox-container" id="metadata-listbox"></div>
            <div class="output" id="metadata-output"></div>
        </div>
    </div>

    <!-- Include required libraries -->
    <script src="datamaster.js"></script>
    <script src="jw-listbox.js"></script>

    <script>
        // Demo data
        const employeeData = [
            { id: 1, name: 'Alice Johnson', department: 'Engineering', salary: 95000, status: 'active' },
            { id: 2, name: 'Bob Smith', department: 'Marketing', salary: 75000, status: 'active' },
            { id: 3, name: 'Carol Williams', department: 'Engineering', salary: 105000, status: 'active' },
            { id: 4, name: 'David Brown', department: 'Sales', salary: 85000, status: 'inactive' },
            { id: 5, name: 'Eve Davis', department: 'HR', salary: 70000, status: 'active' },
            { id: 6, name: 'Frank Miller', department: 'Engineering', salary: 110000, status: 'active' },
            { id: 7, name: 'Grace Wilson', department: 'Marketing', salary: 80000, status: 'active' },
            { id: 8, name: 'Henry Moore', department: 'Sales', salary: 90000, status: 'inactive' }
        ];

        let printListbox, loadingListbox, exportListbox, metadataListbox;

        // Initialize all demo listboxes
        function initializeDemo() {
            try {
                // Print Mode Demo
                printListbox = new JwListBox('#print-listbox');
                printListbox.setSource(employeeData)
                    .setTemplate(document.getElementById('regular-template').value)
                    .setPrintTemplate(document.getElementById('print-template').value)
                    .setDisplayMode('list')
                    .on('printModeChanged', (data) => {
                        updateOutput('print-output', `Print mode changed: ${data.printMode}`);
                        document.getElementById('print-status').textContent = `Print Mode: ${data.printMode ? 'ON' : 'OFF'}`;
                    });

                // Loading Indicators Demo
                loadingListbox = new JwListBox('#loading-listbox');
                loadingListbox.setSource(employeeData.slice(0, 3))
                    .setDisplayMode('grid')
                    .on('loadingChanged', (data) => {
                        updateOutput('loading-output', `Loading changed: ${data.loading ? 'SHOWN' : 'HIDDEN'} - "${data.message}"`);
                    })
                    .on('loadMoreChanged', (data) => {
                        updateOutput('loading-output', `Load more changed: ${data.showLoadMore ? 'SHOWN' : 'HIDDEN'} - "${data.message}"`);
                    })
                    .on('more', (data) => {
                        updateOutput('loading-output', `Load more clicked! Current rows: ${data.currentRowCount}`);
                        simulateLoadMoreData();
                    });

                // Data Export Demo
                exportListbox = new JwListBox('#export-listbox');
                exportListbox.setSource(employeeData)
                    .setDisplayMode('grid');

                // Metadata Demo
                metadataListbox = new JwListBox('#metadata-listbox');
                metadataListbox.setSource(employeeData)
                    .setDisplayMode('grid');

                updateOutput('print-output', 'Print mode demo initialized');
                updateOutput('loading-output', 'Loading indicators demo initialized');
                updateOutput('export-output', 'Data export demo initialized');
                updateOutput('metadata-output', 'Metadata demo initialized');
                
            } catch (error) {
                console.error('Demo initialization failed:', error);
                alert('Demo initialization failed: ' + error.message);
            }
        }

        // Utility function to update output displays
        function updateOutput(outputId, message) {
            const output = document.getElementById(outputId);
            const timestamp = new Date().toLocaleTimeString();
            output.textContent += `[${timestamp}] ${message}\n`;
            output.scrollTop = output.scrollHeight;
        }

        // Print Mode Functions
        function togglePrintMode() {
            const currentMode = printListbox._options.printMode || false;
            
            if (!currentMode) {
                // Enabling print mode - ensure print template is set first
                const printTemplate = document.getElementById('print-template').value;
                printListbox.setPrintTemplate(printTemplate);
                updateOutput('print-output', 'Print template set before enabling print mode');
            }
            
            printListbox.printMode(!currentMode);
        }

        function setPrintTemplate() {
            const printTemplate = document.getElementById('print-template').value;
            printListbox.setPrintTemplate(printTemplate);
            updateOutput('print-output', 'Custom print template set');
        }

        // Loading Indicator Functions
        function showLoadingIndicator() {
            loadingListbox.showLoading(true, 'Loading employee data...');
        }

        function hideLoadingIndicator() {
            loadingListbox.showLoading(false);
        }

        function showLoadMoreButton() {
            loadingListbox.showLoadMore(true, 'Load More Employees');
        }

        function hideLoadMoreButton() {
            loadingListbox.showLoadMore(false);
        }

        function simulateDataLoading() {
            showLoadingIndicator();
            setTimeout(() => {
                loadingListbox.setSource(employeeData);
                hideLoadingIndicator();
                updateOutput('loading-output', 'Data loading simulation completed');
            }, 2000);
        }

        function simulateLoadMoreData() {
            const moreData = [
                { id: 9, name: 'Ivy Taylor', department: 'Finance', salary: 88000, status: 'active' },
                { id: 10, name: 'Jack Anderson', department: 'IT', salary: 92000, status: 'active' }
            ];
            
            showLoadingIndicator();
            setTimeout(() => {
                const currentData = loadingListbox.getSource('recordset');
                const newData = [...currentData, ...moreData];
                loadingListbox.setSource(newData);
                hideLoadingIndicator();
                hideLoadMoreButton();
                updateOutput('loading-output', `Added ${moreData.length} more records`);
            }, 1000);
        }

        // Data Export Functions
        function exportAsRecordset() {
            const data = exportListbox.getSource('recordset');
            updateOutput('export-output', `Exported ${data.length} records as recordset:\n${JSON.stringify(data.slice(0, 2), null, 2)}...`);
        }

        function exportAsTable() {
            const data = exportListbox.getSource('table', false, { includeHeaders: true });
            updateOutput('export-output', `Exported as table (${data.length} rows including header):\n${JSON.stringify(data.slice(0, 3), null, 2)}...`);
        }

        function exportAsCSV() {
            const data = exportListbox.getSource('csv', false, { includeHeaders: true });
            updateOutput('export-output', `Exported as CSV:\n${data.split('\\n').slice(0, 4).join('\\n')}...`);
        }

        function exportAllData() {
            const data = exportListbox.getSource('recordset', true); // Get all data from master
            updateOutput('export-output', `Exported all master data: ${data.length} records`);
        }

        function filterAndExport() {
            // Apply a search filter
            exportListbox.search('Engineering');
            const filteredData = exportListbox.getSource('recordset');
            updateOutput('export-output', `Filtered for 'Engineering' and exported: ${filteredData.length} records`);
            
            // Clear search to restore all data
            setTimeout(() => {
                exportListbox.clearSearch();
                updateOutput('export-output', 'Search cleared, all data restored');
            }, 2000);
        }

        // Metadata Functions
        function getRowCount() {
            const count = metadataListbox.length();
            updateOutput('metadata-output', `Current row count: ${count}`);
        }

        function getFieldNames() {
            const fields = metadataListbox.getFields();
            updateOutput('metadata-output', `Field names: ${fields.join(', ')}`);
        }

        function getFieldsFromMaster() {
            const fields = metadataListbox.getFields(true);
            updateOutput('metadata-output', `Master field names: ${fields.join(', ')}`);
        }

        function addDataAndUpdateMetadata() {
            const newEmployee = { id: 99, name: 'New Employee', department: 'Test', salary: 50000, status: 'active' };
            metadataListbox.addData([newEmployee]);
            
            const newCount = metadataListbox.length();
            updateOutput('metadata-output', `Added 1 employee. New row count: ${newCount}`);
        }

        function searchAndUpdateMetadata() {
            metadataListbox.search('Engineering');
            const filteredCount = metadataListbox.length();
            updateOutput('metadata-output', `Searched for 'Engineering'. Filtered row count: ${filteredCount}`);
            
            // Clear search after 2 seconds
            setTimeout(() => {
                metadataListbox.clearSearch();
                const fullCount = metadataListbox.length();
                updateOutput('metadata-output', `Search cleared. Full row count: ${fullCount}`);
            }, 2000);
        }

        // Initialize demo when page loads
        document.addEventListener('DOMContentLoaded', initializeDemo);
    </script>
</body>
</html>
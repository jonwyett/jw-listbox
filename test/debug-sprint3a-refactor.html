<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JwListBox Sprint 3a Refactor Debug - Public Contract & Extensibility</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }
        .container {
            width: 600px;
            height: 300px;
            border: 2px solid #333;
            margin: 20px 0;
        }
        .controls {
            margin: 10px 0;
        }
        button {
            margin: 5px;
            padding: 8px 16px;
        }
        .debug {
            background: #f5f5f5;
            padding: 10px;
            margin: 10px 0;
            border: 1px solid #ccc;
            font-family: monospace;
            white-space: pre-wrap;
            max-height: 300px;
            overflow-y: auto;
        }
        .section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            background: #f9f9f9;
        }
        .section h3 {
            margin-top: 0;
        }
        .event-log {
            background: #e8f4f8;
            border: 1px solid #b0d4e3;
            padding: 10px;
            margin: 10px 0;
            max-height: 200px;
            overflow-y: auto;
            font-family: monospace;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <h1>JwListBox Sprint 3a Refactor Debug</h1>
    <p>Testing the Public Contract & Extensibility Framework</p>

    <!-- ID System Testing -->
    <div class="section">
        <h3>ID System Testing</h3>
        <button onclick="testIndexBasedIds()">Test Index-Based IDs</button>
        <button onclick="testFieldBasedIds()">Test Field-Based IDs (user.id)</button>
        <button onclick="testInvalidIdField()">Test Invalid ID Field</button>
    </div>

    <!-- Event System Testing -->
    <div class="section">
        <h3>Event System Testing</h3>
        <button onclick="testLifecycleEvents()">Test Lifecycle Events</button>
        <button onclick="clearEventLog()">Clear Event Log</button>
    </div>

    <!-- Interaction Testing -->
    <div class="section">
        <h3>Interaction Testing</h3>
        <p><strong>Instructions:</strong></p>
        <ul>
            <li>Click on rows to test row click events</li>
            <li>Double-click on rows to test double-click events</li>
            <li>Right-click on rows to test context menu events</li>
            <li>Hover over rows to test mouse enter/leave events</li>
            <li>Focus the listbox and press keys to test keyboard events</li>
        </ul>
    </div>

    <div class="controls">
        <button onclick="clearDebug()">Clear Debug</button>
    </div>

    <div id="debug-output" class="debug"></div>
    
    <h3>Event Log</h3>
    <div id="event-log" class="event-log"></div>
    
    <div id="container1" class="container"></div>

    <!-- Test Template -->
    <template id="user-template">
        <div class="user-card" style="border: 1px solid #ddd; padding: 10px; margin: 5px 0; border-radius: 4px;">
            <h4 style="margin: 0 0 5px 0; color: #333;">{{name}} (ID: {{id}})</h4>
            <p style="margin: 0; color: #666;">Email: {{email}}</p>
            <p style="margin: 5px 0 0 0; font-size: 0.9em;">Department: {{department}}</p>
        </div>
    </template>

    <!-- Load DataMaster and JwListBox -->
    <script src="datamaster.js"></script>
    <script src="jw-listbox.js"></script>

    <script>
        let listbox;
        
        function log(message) {
            const debugOutput = document.getElementById('debug-output');
            debugOutput.textContent += new Date().toLocaleTimeString() + ': ' + message + '\n';
            console.log(message);
        }

        function logEvent(eventName, payload) {
            const eventLog = document.getElementById('event-log');
            const timestamp = new Date().toLocaleTimeString();
            const eventInfo = `[${timestamp}] ${eventName}: ${JSON.stringify(payload, null, 2)}\n`;
            eventLog.textContent += eventInfo;
            eventLog.scrollTop = eventLog.scrollHeight;
        }
        
        function clearDebug() {
            document.getElementById('debug-output').textContent = '';
        }

        function clearEventLog() {
            document.getElementById('event-log').textContent = '';
        }

        // Test data with various ID scenarios
        const testDataWithIds = [
            { 
                id: 'user-001', 
                name: 'Alice Johnson', 
                email: 'alice@example.com',
                department: 'Engineering'
            },
            { 
                id: 'user-002', 
                name: 'Bob Smith', 
                email: 'bob@example.com',
                department: 'Marketing'
            },
            { 
                id: 'user-003', 
                name: 'Charlie Brown', 
                email: 'charlie@example.com',
                department: 'Sales'
            }
        ];

        const testDataWithoutIds = [
            { 
                name: 'David Wilson', 
                email: 'david@example.com',
                department: 'Support'
            },
            { 
                name: 'Eve Davis', 
                email: 'eve@example.com',
                department: 'HR'
            }
        ];

        function createListbox() {
            if (listbox) listbox.destroy();
            
            listbox = new JwListBox('#container1');
            
            // Set up all event listeners
            listbox.on('beforeRender', (payload) => logEvent('beforeRender', payload));
            listbox.on('render', (payload) => logEvent('render', payload));
            listbox.on('beforeDestroy', (payload) => logEvent('beforeDestroy', payload));
            listbox.on('destroy', (payload) => logEvent('destroy', payload));
            
            listbox.on('click', (payload) => logEvent('click', payload));
            listbox.on('dblclick', (payload) => logEvent('dblclick', payload));
            listbox.on('rowContextMenu', (payload) => logEvent('rowContextMenu', payload));
            listbox.on('rowMouseEnter', (payload) => logEvent('rowMouseEnter', payload));
            listbox.on('rowMouseLeave', (payload) => logEvent('rowMouseLeave', payload));
            
            
            listbox.on('keydown', (payload) => logEvent('keydown', payload));
            
            listbox.on('error', (error) => {
                log('Error: ' + JSON.stringify(error));
                logEvent('error', error);
            });

            return listbox;
        }

        function testIndexBasedIds() {
            log('=== Testing Index-Based IDs ===');
            
            const lb = createListbox();
            lb.setTemplate('#user-template')
              .setSource(testDataWithoutIds);
            
            log('Created listbox with index-based IDs. Click on rows to see ID values in event log.');
        }

        function testFieldBasedIds() {
            log('=== Testing Field-Based IDs (id field) ===');
            
            const lb = createListbox();
            lb.setIdField('id')
              .setTemplate('#user-template')
              .setSource(testDataWithIds);
            
            log('Created listbox with field-based IDs using "id" field. Click on rows to see ID values in event log.');
        }

        function testInvalidIdField() {
            log('=== Testing Invalid ID Field ===');
            
            const lb = createListbox();
            lb.setIdField('nonexistent')
              .setTemplate('#user-template')
              .setSource(testDataWithIds);
            
            log('Created listbox with invalid ID field "nonexistent". Should fall back to index-based IDs.');
        }


        function testLifecycleEvents() {
            log('=== Testing Lifecycle Events ===');
            
            const lb = createListbox();
            lb.setTemplate('#user-template')
              .setSource(testDataWithIds);
            
            log('Listbox created. Check event log for beforeRender and render events.');
            
            setTimeout(() => {
                log('Destroying listbox to test destroy lifecycle events...');
                lb.destroy();
                log('Listbox destroyed. Check event log for beforeDestroy and destroy events.');
            }, 2000);
        }

        // Auto-initialize
        setTimeout(() => {
            log('Auto-initializing with index-based IDs...');
            testIndexBasedIds();
        }, 500);
    </script>
</body>
</html>
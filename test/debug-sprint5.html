<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JwListBox Sprint 5 Debug - Grid Mode</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }
        .container {
            width: 800px;
            height: 400px;
            border: 2px solid #333;
            margin: 20px 0;
        }
        .controls {
            margin: 10px 0;
        }
        button {
            margin: 5px;
            padding: 8px 16px;
        }
        .debug {
            background: #f5f5f5;
            padding: 10px;
            margin: 10px 0;
            border: 1px solid #ccc;
            font-family: monospace;
            white-space: pre-wrap;
            max-height: 200px;
            overflow-y: auto;
        }
        .section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            background: #f9f9f9;
        }
        .section h3 {
            margin-top: 0;
        }
        .event-log {
            background: #e8f4f8;
            border: 1px solid #b0d4e3;
            padding: 10px;
            margin: 10px 0;
            max-height: 200px;
            overflow-y: auto;
            font-family: monospace;
            font-size: 12px;
        }
        .mode-display {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            padding: 10px;
            margin: 10px 0;
            font-family: monospace;
            font-weight: bold;
        }
        .comparison {
            display: flex;
            gap: 20px;
            margin: 20px 0;
        }
        .comparison > div {
            flex: 1;
            border: 2px solid #666;
            height: 300px;
        }
        .comparison h4 {
            text-align: center;
            margin: 0 0 10px 0;
            padding: 5px;
            background: #f0f0f0;
        }
    </style>
</head>
<body>
    <h1>JwListBox Sprint 5 Debug - Grid Mode</h1>
    <p>Testing the alternative &lt;table&gt; rendering mode and grid-specific features</p>

    <!-- Current Mode Display -->
    <div class="mode-display">
        Current Mode: <span id="mode-display">list</span>
    </div>

    <!-- Display Mode Testing -->
    <div class="section">
        <h3>Display Mode Testing</h3>
        <button onclick="setListMode()">List Mode (&lt;ul&gt;)</button>
        <button onclick="setGridMode()">Grid Mode (&lt;table&gt;)</button>
        <button onclick="toggleDisplayMode()">Toggle Mode</button>
    </div>

    <!-- Grid Mode Configuration -->
    <div class="section">
        <h3>Grid Mode Configuration</h3>
        <p><em>Column widths support all valid CSS width values: px, %, rem, em, vh, vw, etc.</em></p>
        <button onclick="toggleTableHeaders()">Toggle Table Headers</button>
        <button onclick="setNarrowColumns()">Set Narrow Columns (px)</button>
        <button onclick="setWideColumns()">Set Wide Columns (px)</button>
        <button onclick="setPercentageColumns()">Set Percentage Columns (%)</button>
        <button onclick="setRemColumns()">Set REM Columns (rem)</button>
        <button onclick="setMixedColumns()">Set Mixed Units</button>
        <button onclick="clearColumnWidths()">Clear Column Widths</button>
    </div>

    <!-- Grid Events Testing -->
    <div class="section">
        <h3>Grid Events Testing</h3>
        <p><em>In grid mode, click events automatically include cell field and value information. Click on individual cells to see enhanced event payload. Click on headers to trigger headerClick events.</em></p>
    </div>

    <!-- Side-by-Side Comparison -->
    <div class="section">
        <h3>Side-by-Side Comparison</h3>
        <button onclick="createComparison()">Create List vs Grid Comparison</button>
        <div class="comparison" id="comparison" style="display: none;">
            <div>
                <h4>List Mode</h4>
                <div id="container-list" style="height: 250px; border: 1px solid #ccc;"></div>
            </div>
            <div>
                <h4>Grid Mode</h4>
                <div id="container-grid" style="height: 250px; border: 1px solid #ccc;"></div>
            </div>
        </div>
    </div>

    <div class="controls">
        <button onclick="clearEventLog()">Clear Event Log</button>
        <button onclick="clearDebug()">Clear Debug</button>
    </div>

    <div id="debug-output" class="debug"></div>
    
    <h3>Event Log</h3>
    <div id="event-log" class="event-log"></div>
    
    <div id="container1" class="container"></div>

    <!-- Load DataMaster and JwListBox -->
    <script src="datamaster.js"></script>
    <script src="jw-listbox.js"></script>

    <script>
        let listbox;
        let comparisonListbox, comparisonGridbox;
        
        function log(message) {
            const debugOutput = document.getElementById('debug-output');
            debugOutput.textContent += new Date().toLocaleTimeString() + ': ' + message + '\n';
            console.log(message);
        }

        function logEvent(eventName, payload) {
            const eventLog = document.getElementById('event-log');
            const timestamp = new Date().toLocaleTimeString();
            
            // Simplify payload for readability
            let simplifiedPayload = payload;
            if (eventName === 'headerClick') {
                simplifiedPayload = {
                    field: payload.field,
                    headerText: payload.headerText
                };
            } else if (eventName === 'click' && payload.field) {
                simplifiedPayload = {
                    field: payload.field,
                    value: payload.value,
                    id: payload.id
                };
            } else if (payload && payload.id !== undefined) {
                simplifiedPayload = {
                    id: payload.id,
                    index: payload.index,
                    ...(payload.field && { field: payload.field })
                };
            }
            
            const eventInfo = `[${timestamp}] ${eventName}: ${JSON.stringify(simplifiedPayload)}\n`;
            eventLog.textContent += eventInfo;
            eventLog.scrollTop = eventLog.scrollHeight;
        }

        function updateModeDisplay() {
            const display = document.getElementById('mode-display');
            if (listbox) {
                display.textContent = listbox._options.displayMode;
            } else {
                display.textContent = 'none';
            }
        }
        
        function clearDebug() {
            document.getElementById('debug-output').textContent = '';
        }

        function clearEventLog() {
            document.getElementById('event-log').textContent = '';
        }

        // Test data with various data types for grid display
        const testData = [
            { 
                id: 1, 
                firstName: 'Alice', 
                lastName: 'Johnson', 
                email: 'alice@example.com',
                department: 'Engineering',
                salary: 85000,
                isActive: true
            },
            { 
                id: 2, 
                firstName: 'Bob', 
                lastName: 'Smith', 
                email: 'bob@example.com',
                department: 'Marketing',
                salary: 65000,
                isActive: true
            },
            { 
                id: 3, 
                firstName: 'Charlie', 
                lastName: 'Brown', 
                email: 'charlie@example.com',
                department: 'Sales',
                salary: 70000,
                isActive: false
            },
            { 
                id: 4, 
                firstName: 'Diana', 
                lastName: 'Prince', 
                email: 'diana@example.com',
                department: 'HR',
                salary: 75000,
                isActive: true
            },
            { 
                id: 5, 
                firstName: 'Ethan', 
                lastName: 'Hunt', 
                email: 'ethan@example.com',
                department: 'Operations',
                salary: 80000,
                isActive: true
            }
        ];

        function createListbox() {
            if (listbox) listbox.destroy();
            
            listbox = new JwListBox('#container1');
            
            // Set up all event listeners
            listbox.on('click', (payload) => logEvent('click', payload));
            listbox.on('dblclick', (payload) => logEvent('dblclick', payload));
            listbox.on('headerClick', (payload) => logEvent('headerClick', payload));
            listbox.on('select', (payload) => logEvent('select', payload));
            
            listbox.on('error', (error) => {
                log('Error: ' + JSON.stringify(error));
                logEvent('error', error);
            });

            // Configure and set data
            listbox.setIdField('id')
                   .setSelectionMode('replace')
                   .setSource(testData);
            
            updateModeDisplay();
            return listbox;
        }

        function setListMode() {
            log('=== Setting List Mode ===');
            
            if (!listbox) createListbox();
            
            listbox.setDisplayMode('list');
            updateModeDisplay();
            log('Switched to list mode - data rendered as <ul> with <li> elements');
        }

        function setGridMode() {
            log('=== Setting Grid Mode ===');
            
            if (!listbox) createListbox();
            
            listbox.setDisplayMode('grid');
            updateModeDisplay();
            log('Switched to grid mode - data rendered as <table> with proper columns');
        }

        function toggleDisplayMode() {
            log('=== Toggling Display Mode ===');
            
            if (!listbox) createListbox();
            
            const currentMode = listbox._options.displayMode;
            const newMode = currentMode === 'list' ? 'grid' : 'list';
            
            listbox.setDisplayMode(newMode);
            updateModeDisplay();
            log(`Toggled from ${currentMode} to ${newMode} mode`);
        }

        function toggleTableHeaders() {
            log('=== Toggling Table Headers ===');
            
            if (!listbox) createListbox();
            
            const currentState = listbox._options.showTableHeaders;
            listbox.setShowTableHeaders(!currentState);
            log(`Table headers ${!currentState ? 'enabled' : 'disabled'}`);
            
            // Switch to grid mode if not already in grid mode to see the effect
            if (listbox._options.displayMode !== 'grid') {
                listbox.setDisplayMode('grid');
                updateModeDisplay();
                log('Switched to grid mode to demonstrate header visibility');
            }
        }

        function setNarrowColumns() {
            log('=== Setting Narrow Column Widths ===');
            
            if (!listbox) createListbox();
            
            const narrowWidths = {
                id: '50px',
                firstName: '80px', 
                lastName: '80px',
                email: '150px',
                department: '100px',
                salary: '80px',
                isActive: '60px'
            };
            
            listbox.setColumnWidths(narrowWidths);
            log('Applied narrow column widths for compact display');
        }

        function setWideColumns() {
            log('=== Setting Wide Column Widths ===');
            
            if (!listbox) createListbox();
            
            const wideWidths = {
                id: '80px',
                firstName: '150px', 
                lastName: '150px',
                email: '250px',
                department: '150px',
                salary: '120px',
                isActive: '100px'
            };
            
            listbox.setColumnWidths(wideWidths);
            log('Applied wide column widths for spacious display');
        }

        function clearColumnWidths() {
            log('=== Clearing Column Widths ===');
            
            if (!listbox) createListbox();
            
            listbox.setColumnWidths(null);
            log('Cleared column widths - using automatic sizing');
        }

        function setPercentageColumns() {
            log('=== Setting Percentage Column Widths ===');
            
            if (!listbox) createListbox();
            
            const percentageWidths = {
                id: '5%',
                firstName: '15%', 
                lastName: '15%',
                email: '25%',
                department: '15%',
                salary: '15%',
                isActive: '10%'
            };
            
            listbox.setColumnWidths(percentageWidths);
            log('Applied percentage-based column widths (responsive to container size)');
        }

        function setRemColumns() {
            log('=== Setting REM Column Widths ===');
            
            if (!listbox) createListbox();
            
            const remWidths = {
                id: '3rem',
                firstName: '8rem', 
                lastName: '8rem',
                email: '12rem',
                department: '9rem',
                salary: '7rem',
                isActive: '5rem'
            };
            
            listbox.setColumnWidths(remWidths);
            log('Applied REM-based column widths (scales with root font size)');
        }

        function setMixedColumns() {
            log('=== Setting Mixed Unit Column Widths ===');
            
            if (!listbox) createListbox();
            
            const mixedWidths = {
                id: '50px',        // Pixels
                firstName: '10%',  // Percentage
                lastName: '8rem',  // REM
                email: '15em',     // EM
                department: '120px', // Pixels
                salary: '6rem',    // REM
                isActive: '5%'     // Percentage
            };
            
            listbox.setColumnWidths(mixedWidths);
            log('Applied mixed CSS units: px, %, rem, em - demonstrates full CSS flexibility');
        }


        function createComparison() {
            log('=== Creating Side-by-Side Comparison ===');
            
            // Clean up existing comparison
            if (comparisonListbox) comparisonListbox.destroy();
            if (comparisonGridbox) comparisonGridbox.destroy();
            
            // Show comparison section
            document.getElementById('comparison').style.display = 'flex';
            
            // Create list mode instance
            comparisonListbox = new JwListBox('#container-list');
            comparisonListbox.setIdField('id')
                             .setDisplayMode('list')
                             .setSource(testData);
            
            // Create grid mode instance
            comparisonGridbox = new JwListBox('#container-grid');
            comparisonGridbox.setIdField('id')
                             .setDisplayMode('grid')
                             .setColumnWidths({
                                 id: '40px',
                                 firstName: '80px',
                                 lastName: '80px',
                                 email: '130px',
                                 department: '80px',
                                 salary: '70px',
                                 isActive: '50px'
                             })
                             .setSource(testData);
            
            log('Created side-by-side comparison: List mode (left) vs Grid mode (right)');
        }

        // Auto-initialize
        setTimeout(() => {
            log('Auto-initializing with grid mode...');
            createListbox();
            setGridMode();
        }, 500);
    </script>
</body>
</html>
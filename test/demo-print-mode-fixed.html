<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JwListBox Print Mode Demo - Fixed</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f8f9fa;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 30px;
        }
        .controls {
            text-align: center;
            margin-bottom: 30px;
        }
        .toggle-btn {
            padding: 12px 24px;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            transition: background-color 0.3s;
        }
        .toggle-btn:hover {
            background-color: #0056b3;
        }
        .print-mode-on {
            background-color: #28a745 !important;
        }
        .print-mode-on:hover {
            background-color: #218838 !important;
        }
        .status {
            margin-left: 15px;
            font-weight: bold;
            color: #666;
        }
        .listbox-container {
            height: 400px;
            border: 1px solid #ddd;
            border-radius: 5px;
            position: relative;
            background: white;
        }
        /* Print mode styles - remove scrollbars and borders */
        .print-mode .jw-listbox__body {
            overflow: visible !important;
            height: auto !important;
        }
        .print-mode .listbox-container {
            height: auto !important;
            overflow: visible !important;
        }
        .instructions {
            text-align: center;
            margin-top: 20px;
            color: #666;
            font-style: italic;
        }
        /* Print styles */
        @media print {
            body {
                background: white;
                margin: 0;
            }
            .container {
                box-shadow: none;
                border: none;
                padding: 0;
            }
            h1, .controls, .instructions {
                display: none !important;
            }
            .listbox-container {
                border: none !important;
                height: auto !important;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>JwListBox Print Mode Demo</h1>
        
        <div class="controls">
            <button id="toggleBtn" class="toggle-btn" onclick="togglePrintMode()">
                Enable Print Mode
            </button>
            <span id="status" class="status">Print Mode: OFF</span>
        </div>

        <div class="listbox-container" id="employee-listbox"></div>
        
        <div class="instructions">
            Try printing this page (Ctrl+P) to see the difference between normal and print modes.
        </div>
    </div>

    <!-- Simplified Templates (no complex conditionals) -->
    <template id="normal-template">
        <div style="padding: 15px; border-bottom: 1px solid #eee; background: #f8f9fa; margin: 5px 0; border-radius: 4px;">
            <h3 style="margin: 0 0 10px 0; color: #0066cc;">{{name}}</h3>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                <div><strong>Department:</strong> {{department}}</div>
                <div><strong>Status:</strong> {{status}}</div>
                <div><strong>Salary:</strong> ${{salary}}</div>
                <div><strong>ID:</strong> #{{id}}</div>
            </div>
        </div>
    </template>

    <template id="print-template">
        <div style="margin-bottom: 8px; page-break-inside: avoid;">
            {{name}} | {{department}} | ${{salary}} | {{status}}
        </div>
    </template>

    <script src="datamaster.js"></script>
    <script src="jw-listbox.js"></script>
    <script>
        const employeeData = [
            { id: 1, name: 'Alice Johnson', department: 'Engineering', salary: 95000, status: 'active' },
            { id: 2, name: 'Bob Smith', department: 'Marketing', salary: 75000, status: 'active' },
            { id: 3, name: 'Carol Williams', department: 'Engineering', salary: 105000, status: 'active' },
            { id: 4, name: 'David Brown', department: 'Sales', salary: 85000, status: 'inactive' },
            { id: 5, name: 'Eve Davis', department: 'HR', salary: 70000, status: 'active' }
        ];

        let listbox;
        let printModeEnabled = false;

        function initializeDemo() {
            console.log('üöÄ Initializing demo...');
            
            // Create listbox with both templates pre-configured
            listbox = new JwListBox('#employee-listbox');
            listbox.setSource(employeeData)
                .setTemplate('#normal-template')
                .setPrintTemplate('#print-template')
                .setDisplayMode('list');
                
            console.log('‚úÖ Demo initialized');
            
            // Verify initial state
            setTimeout(() => {
                const content = document.querySelector('#employee-listbox').innerHTML;
                console.log('üìÑ Initial content length:', content.length);
                console.log('üìÑ Initial content preview:', content.substring(0, 150) + '...');
            }, 100);
        }

        function togglePrintMode() {
            printModeEnabled = !printModeEnabled;
            
            console.log('üîÑ Toggling print mode to:', printModeEnabled);
            
            // Debug: Log template states before toggle
            console.log('üìã Before toggle:', {
                printMode: listbox._options.printMode,
                template: listbox._options.template,
                printTemplate: listbox._options.printTemplate
            });
            
            listbox.printMode(printModeEnabled);
            
            // Debug: Log template states after toggle
            console.log('üìã After toggle:', {
                printMode: listbox._options.printMode,
                template: listbox._options.template,
                printTemplate: listbox._options.printTemplate
            });
            
            // Check what template is being retrieved
            setTimeout(() => {
                try {
                    const currentTemplate = listbox._getTemplate();
                    console.log('üéØ Current template retrieved:', currentTemplate ? currentTemplate.substring(0, 100) + '...' : 'NULL');
                    
                    const content = document.querySelector('#employee-listbox').innerHTML;
                    console.log('üìÑ Content after toggle length:', content.length);
                    console.log('üìÑ Content after toggle preview:', content.substring(0, 150) + '...');
                    
                } catch (error) {
                    console.error('‚ùå Error checking template:', error);
                }
            }, 50);
            
            // Update UI and add/remove print-mode class
            const btn = document.getElementById('toggleBtn');
            const status = document.getElementById('status');
            const container = document.querySelector('.container');
            
            if (printModeEnabled) {
                btn.textContent = 'Disable Print Mode';
                btn.classList.add('print-mode-on');
                status.textContent = 'Print Mode: ON';
                status.style.color = '#28a745';
                container.classList.add('print-mode');
            } else {
                btn.textContent = 'Enable Print Mode';
                btn.classList.remove('print-mode-on');
                status.textContent = 'Print Mode: OFF';
                status.style.color = '#666';
                container.classList.remove('print-mode');
            }
        }

        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', initializeDemo);
    </script>
</body>
</html>